#!/bin/bash
echo 'Processing...'
#TIME=$(date +"%Y-%m-%d-%H-%M-%S")
TIME=2024-08-18-17-01-15
if [ ! -s ./follower/last.txt ]; then
    cat ./follower/json/init.json | grep 'screen_name' | sort > ./follower/$TIME.txt
else
    cat ./follower/json/last.txt | grep 'screen_name' | sort > ./follower/$TIME.txt
fi

mv ~/Downloads/twitter-Followers* ./follower/json/$TIME.json

if [ -s ./follower/json/last.txt ]; then
    mv $(cat ./follower/json/last.txt) ./follower/json/old/
fi

mv ./follower/json/recent.txt ./follower/json/last.txt
echo ./follower/json/$TIME.json > ./follower/json/recent.txt
mv $(cat ./follower/last.txt) ./follower/old/
cat ./follower/json/$TIME.json | grep 'screen_name' | sort > ./follower/$TIME.txt
mv ./follower/recent.txt ./follower/last.txt
echo ./follower/$TIME.txt > ./follower/recent.txt
sleep 2

if [ ! -s ./following/last.txt ]; then
    cat ./following/json/init.json | grep 'screen_name' | sort > ./following/$TIME.txt
else
    cat ./following/json/last.txt | grep 'screen_name' | sort > ./following/$TIME.txt
fi

mv ~/Downloads/twitter-Following* ./following/json/$TIME.json

if [ -s ./following/json/last.txt ]; then
    mv $(cat ./following/json/last.txt) ./following/json/old/
fi

mv ./following/json/recent.txt ./following/json/last.txt
echo ./following/json/$TIME.json > ./following/json/recent.txt
mv $(cat ./following/last.txt) ./following/old/
cat ./following/json/$TIME.json | grep 'screen_name' | sort > ./following/$TIME.txt
mv ./following/recent.txt ./following/last.txt
echo ./following/$TIME.txt > ./following/recent.txt
echo 'Done.'

sleep 1

echo $(grep -o 'screen_name' ./follower/$TIME.txt | wc -l)' Followers, Diff:' > ./diff.txt
if [ -s ./follower/last.txt ] && [ -s ./follower/recent.txt ]; then
    diff $(cat ./follower/last.txt) $(cat ./follower/recent.txt) >> ./diff.txt
fi
echo " " >> ./diff.txt
echo $(grep -o 'screen_name' ./following/$TIME.txt | wc -l)' Following, Diff:' >> ./diff.txt
if [ -s ./following/last.txt ] && [ -s ./following/recent.txt ]; then
    diff $(cat ./following/last.txt) $(cat ./following/recent.txt) >> ./diff.txt
fi

sed -i 's/"/`/g' ./diff.txt
#python3 ./tgbot.py
#clear
rm -rf ./temp/*
cat ./diff.txt
